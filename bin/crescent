#!/usr/bin/env bash
# Crescent CLI wrapper
# This script wraps the luvit command to make CLI usage easier

# Determina o diretório onde o script está instalado
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PARENT_DIR="$(dirname "$SCRIPT_DIR")"

# Procura pelo crescent-cli.lua
CLI_LOCATIONS=(
    "$PARENT_DIR/crescent-cli.lua"           # Instalado via lit
    "$SCRIPT_DIR/../crescent-cli.lua"        # Desenvolvimento
    "./crescent-cli.lua"                      # Diretório atual
)

CLI_PATH=""
for path in "${CLI_LOCATIONS[@]}"; do
    if [ -f "$path" ]; then
        CLI_PATH="$path"
        break
    fi
done

if [ -z "$CLI_PATH" ]; then
    echo "Error: Could not find crescent-cli.lua"
    echo "Please make sure crescent is properly installed via luarocks"
    exit 1
fi

# Check if luvit is installed
if ! command -v luvit &> /dev/null; then
    echo "Error: luvit is not installed"
    echo ""
    echo "Install luvit first:"
    echo "  macOS:  brew install luvit"
    echo "  Linux:  curl -L https://github.com/luvit/lit/raw/master/get-lit.sh | sh"
    exit 1
fi

# Execute the CLI with luvit, passing all arguments
exec luvit "$CLI_PATH" "$@"
